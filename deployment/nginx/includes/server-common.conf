# Shared server block settings (security headers, logging, locations)

# Security Headers
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
add_header X-Frame-Options "SAMEORIGIN" always;
add_header X-Content-Type-Options "nosniff" always;
add_header X-XSS-Protection "1; mode=block" always;
add_header Referrer-Policy "strict-origin-when-cross-origin" always;
add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://static.cloudflareinsights.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: blob: https:; connect-src 'self' https://stage.legal.org.ua https://accounts.google.com https://cloudflareinsights.com; frame-src 'self' https://accounts.google.com; object-src 'none'; base-uri 'self';" always;

# Logging
access_log /var/log/nginx/stage.legal.org.ua-access.log;
error_log /var/log/nginx/stage.legal.org.ua-error.log;

# Settings
client_max_body_size 50M;

# Grafana monitoring UI
location /grafana/ {
    proxy_pass http://grafana-stage:3000/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection $connection_upgrade;
}

# Include modular configurations
include /etc/nginx/includes/oauth-endpoints.conf;
include /etc/nginx/includes/mcp-endpoints.conf;
include /etc/nginx/includes/api-endpoints.conf;
include /etc/nginx/includes/frontend-routes.conf;
