<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecondLayer MCP - Web Client Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1890ff;
            margin-bottom: 8px;
        }
        .subtitle {
            color: #8c8c8c;
            margin-bottom: 24px;
        }
        .config-section {
            margin-bottom: 24px;
        }
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #262626;
        }
        input, textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        textarea {
            font-family: 'Monaco', 'Menlo', monospace;
            resize: vertical;
        }
        button {
            background: #1890ff;
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-right: 8px;
        }
        button:hover {
            background: #40a9ff;
        }
        button:disabled {
            background: #d9d9d9;
            cursor: not-allowed;
        }
        .results {
            margin-top: 24px;
            padding: 16px;
            background: #f9f9f9;
            border-radius: 4px;
            border: 1px solid #d9d9d9;
        }
        .event {
            margin-bottom: 12px;
            padding: 12px;
            background: white;
            border-radius: 4px;
            border-left: 3px solid #1890ff;
        }
        .event-type {
            font-weight: 600;
            color: #1890ff;
            margin-bottom: 4px;
        }
        .event-data {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            color: #262626;
            white-space: pre-wrap;
        }
        .error {
            color: #ff4d4f;
            border-left-color: #ff4d4f;
        }
        .success {
            color: #52c41a;
            border-left-color: #52c41a;
        }
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }
        .tool-card {
            padding: 12px;
            background: #fafafa;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            cursor: pointer;
        }
        .tool-card:hover {
            border-color: #1890ff;
            background: #f0f9ff;
        }
        .tool-name {
            font-weight: 600;
            color: #262626;
            margin-bottom: 4px;
        }
        .tool-description {
            font-size: 12px;
            color: #8c8c8c;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>SecondLayer MCP Web Client</h1>
        <p class="subtitle">Демонстрація підключення до MCP сервера через HTTP/SSE</p>

        <div class="config-section">
            <label for="apiUrl">API URL:</label>
            <input type="text" id="apiUrl" value="http://localhost:3000" placeholder="http://localhost:3000">
        </div>

        <div class="config-section">
            <label for="apiKey">API Key:</label>
            <input type="text" id="apiKey" value="test-key-123" placeholder="test-key-123">
        </div>

        <div class="config-section">
            <button onclick="listTools()">Список інструментів</button>
            <button onclick="testSearch()">Тест пошуку</button>
            <button onclick="testSearchSSE()">Тест SSE стрімінгу</button>
        </div>

        <div class="config-section">
            <label for="customQuery">Власний запит:</label>
            <textarea id="customQuery" rows="4" placeholder='{"query": "справи про ухилення від мобілізації"}'></textarea>
            <button onclick="executeCustom()" style="margin-top: 8px;">Виконати</button>
            <button onclick="executeCustomSSE()" style="margin-top: 8px;">Виконати (SSE)</button>
        </div>

        <div id="results" class="results" style="display: none;">
            <h3>Результати:</h3>
            <div id="resultsContent"></div>
        </div>
    </div>

    <script>
        const API_BASE = () => document.getElementById('apiUrl').value;
        const API_KEY = () => document.getElementById('apiKey').value;

        function addEvent(type, data, isError = false) {
            const results = document.getElementById('results');
            const content = document.getElementById('resultsContent');
            results.style.display = 'block';

            const event = document.createElement('div');
            event.className = 'event' + (isError ? ' error' : '');

            const eventType = document.createElement('div');
            eventType.className = 'event-type';
            eventType.textContent = type;

            const eventData = document.createElement('div');
            eventData.className = 'event-data';
            eventData.textContent = typeof data === 'string' ? data : JSON.stringify(data, null, 2);

            event.appendChild(eventType);
            event.appendChild(eventData);
            content.insertBefore(event, content.firstChild);
        }

        function clearResults() {
            document.getElementById('resultsContent').innerHTML = '';
        }

        async function listTools() {
            clearResults();
            try {
                const response = await fetch(`${API_BASE()}/api/tools`, {
                    headers: {
                        'Authorization': `Bearer ${API_KEY()}`
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${await response.text()}`);
                }

                const data = await response.json();
                addEvent('Список інструментів', data);

                // Display tools in grid
                if (data.tools) {
                    const gridHtml = '<div class="tools-grid">' +
                        data.tools.map(tool => `
                            <div class="tool-card">
                                <div class="tool-name">${tool.name}</div>
                                <div class="tool-description">${tool.description || ''}</div>
                            </div>
                        `).join('') +
                        '</div>';

                    const gridDiv = document.createElement('div');
                    gridDiv.innerHTML = gridHtml;
                    document.getElementById('resultsContent').appendChild(gridDiv);
                }
            } catch (error) {
                addEvent('Помилка', error.message, true);
            }
        }

        async function testSearch() {
            clearResults();
            try {
                const response = await fetch(`${API_BASE()}/api/tools/search_legal_precedents`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${API_KEY()}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        query: "справи про ухилення від мобілізації 2023",
                        limit: 3
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${await response.text()}`);
                }

                const data = await response.json();
                addEvent('Результати пошуку', data);
            } catch (error) {
                addEvent('Помилка', error.message, true);
            }
        }

        async function testSearchSSE() {
            clearResults();
            addEvent('SSE Стрімінг', 'Підключення...');

            const eventSource = new EventSource(
                `${API_BASE()}/api/tools/search_legal_precedents/stream?` +
                new URLSearchParams({
                    authorization: `Bearer ${API_KEY()}`,
                    query: "справи про ухилення від мобілізації 2023",
                    limit: "3"
                })
            );

            eventSource.onmessage = (event) => {
                try {
                    const data = JSON.parse(event.data);
                    addEvent(`SSE: ${data.type || 'message'}`, data);

                    if (data.type === 'complete' || data.type === 'error') {
                        eventSource.close();
                    }
                } catch (e) {
                    addEvent('SSE: raw', event.data);
                }
            };

            eventSource.onerror = (error) => {
                addEvent('SSE Помилка', error, true);
                eventSource.close();
            };

            // Auto-close after 30 seconds
            setTimeout(() => eventSource.close(), 30000);
        }

        async function executeCustom() {
            clearResults();
            try {
                const queryText = document.getElementById('customQuery').value;
                const queryData = JSON.parse(queryText);

                const response = await fetch(`${API_BASE()}/api/tools/search_legal_precedents`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${API_KEY()}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(queryData)
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${await response.text()}`);
                }

                const data = await response.json();
                addEvent('Результат', data);
            } catch (error) {
                addEvent('Помилка', error.message, true);
            }
        }

        async function executeCustomSSE() {
            clearResults();
            try {
                const queryText = document.getElementById('customQuery').value;
                const queryData = JSON.parse(queryText);

                addEvent('SSE Стрімінг', 'Підключення...');

                const params = new URLSearchParams({
                    authorization: `Bearer ${API_KEY()}`,
                    ...queryData
                });

                const eventSource = new EventSource(
                    `${API_BASE()}/api/tools/search_legal_precedents/stream?${params}`
                );

                eventSource.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        addEvent(`SSE: ${data.type || 'message'}`, data);

                        if (data.type === 'complete' || data.type === 'error') {
                            eventSource.close();
                        }
                    } catch (e) {
                        addEvent('SSE: raw', event.data);
                    }
                };

                eventSource.onerror = (error) => {
                    addEvent('SSE Помилка', error, true);
                    eventSource.close();
                };

                setTimeout(() => eventSource.close(), 30000);
            } catch (error) {
                addEvent('Помилка', error.message, true);
            }
        }
    </script>
</body>
</html>
